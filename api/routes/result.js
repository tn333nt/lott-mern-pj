
const express = require('express')
const { body } = require('express-validator')

const resultController = require('../controllers/result')
const isAdmin = require('../middleware/isAdmin')
const isAuth = require('../middleware/isAuth')

const router = express.Router()

router.get('/results', resultController.getAllResults)

router.post('/result', [
    // for the showing order
    body('jackpot.winningValues')
        .notEmpty()
        .withMessage('Jackpot is required')
        .isArray({ min: 1, max: 1 })
        .withMessage('Jackpot requires 1 ticket')
    , body('jackpot.winningValues.*')
        .trim()
        .isLength({ min: 6, max: 6 })
        .withMessage('Jackpot requires 6 digits long')
        .isNumeric()
        .withMessage('Jackpot only contains numbers')

    , body('secondPrizes.winningValues')
        .notEmpty()
        .withMessage('Second prizes is required')
        .isArray({ min: 3, max: 3 }) // hardcoded here
        .withMessage('Second prizes require 3 tickets')
    , body('secondPrizes.winningValues.*')
        .trim()
        .isLength({ min: 5, max: 5 })
        .withMessage('Second prize requires 5 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Second prizes only contain number and comma')

    , body('firstPrizes.winningValues')
        .notEmpty()
        .withMessage('First prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('First prizes require 3 tickets')
    , body('firstPrizes.winningValues.*')
        .trim()
        .isLength({ min: 6, max: 6 })
        .withMessage('First prize requires 6 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('First prizes only contain number and comma')

    , body('thirdPrizes.winningValues')
        .notEmpty()
        .withMessage('Third prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('Third prizes require 3 tickets')
    , body('thirdPrizes.winningValues.*')
        .trim()
        .isLength({ min: 4, max: 4 })
        .withMessage('Third prize requires 4 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Third prizes only contain number and comma')

    , body('fourthPrizes.winningValues')
        .notEmpty()
        .withMessage('Fourth prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('Fourth prizes require 3 tickets')
    , body('fourthPrizes.winningValues.*')
        .trim()
        .isLength({ min: 3, max: 3 })
        .withMessage('Fourth prize requires 3 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Fourth prizes only contain number and comma')

    , body('fifthPrizes.winningValues')
        .notEmpty()
        .withMessage('Fifth prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('Fifth prizes require 3 tickets')
    , body('fifthPrizes.winningValues.*')
        .trim()
        .isLength({ min: 2, max: 2 })
        .withMessage('Fifth prize requires 2 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Fifth prizes only contain number and comma')

], isAuth, isAdmin, resultController.postResult)


// https://express-validator.github.io/docs/wildcards.html
router.patch('/result/:resultId', [
    body('jackpot.winningValues')
        .notEmpty()
        .withMessage('Jackpot is required')
        .isArray({ min: 1, max: 1 })
        .withMessage('Jackpot requires 1 ticket')
    , body('jackpot.winningValues.*')
        .trim()
        .isLength({ min: 6, max: 6 })
        .withMessage('Jackpot requires 6 digits long')
        .isNumeric()
        .withMessage('Jackpot only contains numbers')

    , body('secondPrizes.winningValues')
        .notEmpty()
        .withMessage('Second prizes is required')
        .isArray({ min: 3, max: 3 }) // https://express-validator.github.io/docs/validation-chain-api.html#isarrayoptions
        .withMessage('Second prizes require 3 tickets')
    , body('secondPrizes.winningValues.*')
        .trim()
        .isLength({ min: 5, max: 5 })
        .withMessage('Second prize requires 5 digits long')
        .matches(/^[0-9,]*$/) // equivalent to regex.test()
        .withMessage('Second prizes only contain number and comma')

    , body('firstPrizes.winningValues')
        .notEmpty()
        .withMessage('First prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('First prizes require 3 tickets')
    , body('firstPrizes.winningValues.*')
        .trim()
        .isLength({ min: 6, max: 6 })
        .withMessage('First prize requires 6 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('First prizes only contain number and comma')

    , body('thirdPrizes.winningValues')
        .notEmpty()
        .withMessage('Third prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('Third prizes require 3 tickets')
    , body('thirdPrizes.winningValues.*')
        .trim()
        .isLength({ min: 4, max: 4 })
        .withMessage('Third prize requires 4 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Third prizes only contain number and comma')

    , body('fourthPrizes.winningValues')
        .notEmpty()
        .withMessage('Fourth prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('Fourth prizes require 3 tickets')
    , body('fourthPrizes.winningValues.*')
        .trim()
        .isLength({ min: 3, max: 3 })
        .withMessage('Fourth prize requires 3 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Fourth prizes only contain number and comma')

    , body('fifthPrizes.winningValues')
        .notEmpty()
        .withMessage('Fifth prizes is required')
        .isArray({ min: 3, max: 3 })
        .withMessage('Fifth prizes require 3 tickets')
    , body('fifthPrizes.winningValues.*')
        .trim()
        .isLength({ min: 2, max: 2 })
        .withMessage('Fifth prize requires 2 digits long')
        .matches(/^[0-9,]*$/)
        .withMessage('Fifth prizes only contain number and comma')

], isAuth, isAdmin, resultController.patchResult)

module.exports = router


/** regex
 * https://itnext.io/understanding-regex-in-javascript-the-easy-way-ad0e5888a3ec
 * https://regex101.com/r/u8xcBx/2
 */